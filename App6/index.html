<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniFile Processor v3 - Premium</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración explícita de Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        // Colores personalizados con mayor contraste
                        glass: {
                            light: 'rgba(255, 255, 255, 0.95)',
                            dark: 'rgba(15, 23, 42, 0.95)',
                            border: 'rgba(0, 0, 0, 0.2)',
                            borderDark: 'rgba(255, 255, 255, 0.15)',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            },
            plugins: [],
        }
    </script>
    <!-- Plugin Typography -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marked para renderizar Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Google Font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* Fondos más sólidos y con mejor contraste */
            --bg-gradient-light: linear-gradient(135deg, #eef2f6 0%, #cbd5e1 100%);
            --bg-gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Fondo dinámico */
        body.light {
            background: var(--bg-gradient-light);
            color: #0f172a;
        }

        body.dark {
            background: var(--bg-gradient-dark);
            color: #f8fafc;
        }

        /* Glassmorphism Classes - Opacidad Aumentada para Legibilidad */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            /* Casi sólido */
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 0, 0, 0.15);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.95);
            /* Casi sólido */
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
        }

        /* Scrollbar contrastada */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* JSON Highlighting - Colores más vivos */
        .json-key {
            color: #d026d0;
            font-weight: 600;
        }

        .dark .json-key {
            color: #e879f9;
        }

        .json-string {
            color: #16a34a;
        }

        .dark .json-string {
            color: #4ade80;
        }

        .json-number {
            color: #2563eb;
        }

        .dark .json-number {
            color: #60a5fa;
        }

        .json-boolean {
            color: #d97706;
            font-weight: bold;
        }

        .dark .json-boolean {
            color: #fbbf24;
        }

        /* Utilidades extra */
        .text-shadow {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="light h-screen overflow-hidden selection:bg-indigo-600 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- CONSTANTES & CONFIG ---
        const MAX_FILE_SIZE_MB = 50;

        // --- COMPONENTES UI CORE ---

        // IconWrapper memoized para evitar renderizados innecesarios
        const Icon = React.memo(({ name, size = 20, className = "" }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (ref.current && window.lucide) {
                    ref.current.innerHTML = '';
                    const iconNode = document.createElement('i');
                    iconNode.setAttribute('data-lucide', name);
                    iconNode.setAttribute('width', size);
                    iconNode.setAttribute('height', size);
                    iconNode.classList.add(...className.split(' ').filter(c => c));
                    ref.current.appendChild(iconNode);
                    window.lucide.createIcons({ root: ref.current });
                }
            }, [name, size, className]);

            return <span ref={ref} className="inline-flex items-center justify-center" />;
        });

        const Tooltip = ({ children, text }) => {
            return (
                <div className="group relative flex items-center">
                    {children}
                    <div className="absolute left-1/2 -translate-x-1/2 bottom-full mb-2 hidden group-hover:block px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg whitespace-nowrap z-50 animate-fade-in">
                        {text}
                        <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
                    </div>
                </div>
            )
        }

        // --- VIEWERS ---

        const JsonViewer = ({ data }) => {
            const containerRef = useRef(null);

            const highlightedHtml = useMemo(() => {
                if (!data) return '';
                try {
                    const jsonString = JSON.stringify(data, null, 2);
                    if (jsonString.length > 500000) return jsonString; // Fallback para JSON muy grandes

                    return jsonString.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                        let cls = 'json-number';
                        if (/^"/.test(match)) {
                            if (/:$/.test(match)) {
                                cls = 'json-key';
                            } else {
                                cls = 'json-string';
                            }
                        } else if (/true|false/.test(match)) {
                            cls = 'json-boolean';
                        } else if (/null/.test(match)) {
                            cls = 'text-gray-500';
                        }
                        return '<span class="' + cls + '">' + match + '</span>';
                    });
                } catch (e) { return "Error visualizando JSON"; }
            }, [data]);

            return (
                <pre className="font-mono text-sm bg-white border border-gray-200 dark:border-gray-700 dark:bg-gray-950 p-6 rounded-xl overflow-auto custom-scroll w-full h-full text-gray-800 dark:text-gray-200"
                    dangerouslySetInnerHTML={{ __html: highlightedHtml }} />
            );
        };

        const MarkdownViewer = ({ content }) => {
            return (
                <div className="prose prose-slate dark:prose-invert max-w-none p-8 bg-white dark:bg-gray-950 rounded-xl shadow-sm overflow-auto custom-scroll h-full border border-gray-100 dark:border-gray-800"
                    dangerouslySetInnerHTML={{ __html: marked.parse(content || '') }} />
            );
        };

        const TextViewer = ({ content, searchTerm }) => {
            const [localSearch, setLocalSearch] = useState(searchTerm || "");

            // Resaltado simple de búsqueda
            const highlightedContent = useMemo(() => {
                if (!searchTerm) return content;
                const parts = content.split(new RegExp(`(${searchTerm})`, 'gi'));
                return parts.map((part, i) =>
                    part.toLowerCase() === searchTerm.toLowerCase()
                        ? <span key={i} className="bg-yellow-300 text-black px-0.5 rounded">{part}</span>
                        : part
                );
            }, [content, searchTerm]);

            return (
                <pre className="font-mono text-sm bg-white dark:bg-gray-950 p-6 rounded-xl border border-gray-200 dark:border-gray-800 overflow-auto custom-scroll h-full whitespace-pre-wrap break-words text-gray-900 dark:text-gray-100">
                    {highlightedContent}
                </pre>
            );
        };

        const ImageViewer = ({ fileUrl, alt }) => {
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });

            const handleWheel = (e) => {
                if (e.ctrlKey) {
                    e.preventDefault();
                    setScale(s => Math.min(Math.max(0.5, s - e.deltaY * 0.01), 5));
                }
            };

            const handleMouseDown = (e) => {
                setIsDragging(true);
                setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                setPosition({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y });
            };

            const handleMouseUp = () => setIsDragging(false);

            return (
                <div className="relative w-full h-full flex items-center justify-center bg-gray-100/50 dark:bg-gray-800/50 rounded-xl overflow-hidden border border-dashed border-gray-300 dark:border-gray-700"
                    onWheel={handleWheel}
                    onMouseLeave={handleMouseUp}
                    onMouseUp={handleMouseUp}
                    onMouseMove={handleMouseMove}>

                    <div className="absolute bottom-4 right-4 flex gap-2 z-10">
                        <div className="bg-white/80 dark:bg-gray-900/80 backdrop-blur p-2 rounded-lg shadow-lg flex items-center gap-2 border border-gray-200 dark:border-gray-700">
                            <button onClick={() => setScale(s => Math.max(0.5, s - 0.2))} className="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded"><Icon name="minus" size={16} /></button>
                            <span className="text-xs font-mono w-12 text-center">{Math.round(scale * 100)}%</span>
                            <button onClick={() => setScale(s => Math.min(5, s + 0.2))} className="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded"><Icon name="plus" size={16} /></button>
                            <div className="w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"></div>
                            <button onClick={() => { setScale(1); setPosition({ x: 0, y: 0 }) }} className="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded" title="Reset"><Icon name="refresh-ccw" size={16} /></button>
                        </div>
                    </div>

                    <div
                        className="cursor-grab active:cursor-grabbing transition-transform duration-75"
                        style={{ transform: `translate(${position.x}px, ${position.y}px) scale(${scale})` }}
                        onMouseDown={handleMouseDown}
                    >
                        <img src={fileUrl} alt={alt} draggable={false} className="max-w-full max-h-full object-contain pointer-events-none" />
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---

        const App = () => {
            const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
            const [files, setFiles] = useState([]);
            const [activeTabId, setActiveTabId] = useState(null);
            const [searchQuery, setSearchQuery] = useState(""); // Filtro sidebar
            const [contentSearch, setContentSearch] = useState(""); // Búsqueda interna
            const [dragActive, setDragActive] = useState(false);
            const [loading, setLoading] = useState(false);
            const inputRef = useRef(null);

            // Efecto para Theme
            useEffect(() => {
                document.body.className = theme === 'dark' ? 'dark bg-gray-900 text-gray-100' : 'light bg-gray-50 text-gray-900';
                localStorage.setItem('theme', theme);
            }, [theme]);

            const toggleTheme = () => setTheme(prev => prev === 'light' ? 'dark' : 'light');

            // Procesar Archivos
            const processFiles = async (fileList) => {
                setLoading(true);
                const newFiles = [];

                for (let i = 0; i < fileList.length; i++) {
                    const file = fileList[i];
                    const fileSizeMB = file.size / (1024 * 1024);

                    if (fileSizeMB > MAX_FILE_SIZE_MB) {
                        alert(`Archivo ${file.name} excede el límite de ${MAX_FILE_SIZE_MB}MB.`);
                        continue;
                    }

                    const ext = file.name.split('.').pop().toLowerCase();
                    const id = Date.now() + i + Math.random().toString(36).substr(2, 9);

                    const fileData = {
                        id,
                        name: file.name,
                        type: file.type,
                        size: fileSizeMB < 1 ? (file.size / 1024).toFixed(2) + ' KB' : fileSizeMB.toFixed(2) + ' MB',
                        ext,
                        content: null,
                        status: 'loading'
                    };

                    // Lectura
                    try {
                        if (['pdf'].includes(ext)) {
                            fileData.content = URL.createObjectURL(file);
                            fileData.status = 'ready';
                            fileData.viewer = 'pdf';
                        } else if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'].includes(ext)) {
                            fileData.content = URL.createObjectURL(file);
                            fileData.status = 'ready';
                            fileData.viewer = 'image';
                        } else {
                            const text = await file.text();
                            fileData.content = text;

                            if (ext === 'json') {
                                try {
                                    fileData.content = JSON.parse(text);
                                    fileData.viewer = 'json';
                                    fileData.status = 'ready';
                                } catch {
                                    fileData.viewer = 'text';
                                    fileData.status = 'error-json';
                                }
                            } else if (ext === 'md') {
                                fileData.viewer = 'markdown';
                                fileData.status = 'ready';
                            } else {
                                fileData.viewer = 'text';
                                fileData.status = 'ready';
                            }
                        }
                    } catch (e) {
                        console.error(e);
                        fileData.status = 'error';
                    }
                    newFiles.push(fileData);
                }

                setFiles(prev => [...prev, ...newFiles]);
                if (newFiles.length > 0) setActiveTabId(newFiles[0].id);
                setLoading(false);
            };

            // Drag & Drop Global
            const handleDrag = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.type === "dragenter" || e.type === "dragover") setDragActive(true);
                else if (e.type === "dragleave") setDragActive(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setDragActive(false);
                if (e.dataTransfer.files?.length) processFiles(e.dataTransfer.files);
            };

            // Manejo de Archivos (Borrar/Cerrar)
            const deleteFile = (e, id) => {
                e.stopPropagation();
                if (!window.confirm("¿Estás seguro de que quieres eliminar este archivo?")) return;

                const newFiles = files.filter(f => f.id !== id);
                setFiles(newFiles);
                if (activeTabId === id) {
                    if (newFiles.length > 0) {
                        setActiveTabId(newFiles[newFiles.length - 1].id);
                    } else {
                        setActiveTabId(null);
                    }
                }
            };

            const activeFile = useMemo(() => files.find(f => f.id === activeTabId), [files, activeTabId]);

            const filteredFiles = useMemo(() =>
                files.filter(f => f.name.toLowerCase().includes(searchQuery.toLowerCase())),
                [files, searchQuery]);

            // Icon Mapping
            const getFileIcon = (ext) => {
                const map = {
                    pdf: 'file-text', json: 'code-2', md: 'file-type-2',
                    js: 'code', html: 'code', css: 'code', txt: 'align-left',
                    png: 'image', jpg: 'image', jpeg: 'image'
                };
                return map[ext] || 'file';
            };

            return (
                <div className="flex h-screen w-full relative" onDragEnter={handleDrag}>

                    {/* Overlay de Drag global */}
                    {dragActive && (
                        <div
                            className="absolute inset-0 z-50 bg-indigo-500/20 backdrop-blur-sm border-4 border-indigo-500 border-dashed flex items-center justify-center animate-fade-in"
                            onDragLeave={handleDrag}
                            onDragOver={handleDrag}
                            onDrop={handleDrop}
                        >
                            <div className="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl flex flex-col items-center animate-scale-in">
                                <Icon name="upload-cloud" size={48} className="text-indigo-500 mb-4" />
                                <h2 className="text-2xl font-bold dark:text-white">Soltar archivos aquí</h2>
                            </div>
                        </div>
                    )}

                    {/* SIDEBAR */}
                    <div className="w-80 flex flex-col glass-panel border-r-0 z-20 transition-all duration-300">
                        {/* Header Sidebar */}
                        <div className="p-4 border-b border-gray-200/50 dark:border-gray-700/50">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-2">
                                    <div className="p-2 bg-indigo-600 rounded-lg text-white shadow-lg shadow-indigo-500/30">
                                        <Icon name="layers" size={20} />
                                    </div>
                                    <h1 className="font-bold text-lg tracking-tight text-gray-900 dark:text-white">OmniFile <span className="text-indigo-700 dark:text-indigo-400">v3</span></h1>
                                </div>
                                <button onClick={toggleTheme} className="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
                                    <Icon name={theme === 'dark' ? 'sun' : 'moon'} size={18} />
                                </button>
                            </div>

                            <div className="relative">
                                <Icon name="search" size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400" />
                                <input
                                    type="text"
                                    placeholder="Filtrar archivos..."
                                    className="w-full bg-white dark:bg-gray-800 pl-9 pr-3 py-2.5 rounded-lg text-sm font-medium border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-indigo-500 outline-none transition shadow-sm text-gray-800 dark:text-gray-100 placeholder-gray-500"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* File List */}
                        <div className="flex-1 overflow-y-auto custom-scroll p-3 space-y-2">
                            {filteredFiles.length === 0 ? (
                                <div className="text-center py-10 opacity-70">
                                    <p className="text-sm font-medium text-gray-600 dark:text-gray-400">No hay archivos</p>
                                    <button onClick={() => inputRef.current.click()} className="mt-4 text-xs font-semibold bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition shadow-sm">
                                        Abrir explorador
                                    </button>
                                </div>
                            ) : (
                                filteredFiles.map(file => (
                                    <div
                                        key={file.id}
                                        onClick={() => setActiveTabId(file.id)}
                                        className={`group p-3 rounded-xl border cursor-pointer transition-all duration-200 hover:shadow-md flex items-center gap-3 relative pr-10
                                            ${activeTabId === file.id
                                                ? 'bg-white dark:bg-gray-800 border-indigo-500 dark:border-indigo-500 shadow-sm ring-1 ring-indigo-500/30'
                                                : 'bg-white/40 dark:bg-gray-800/40 border-transparent hover:bg-white hover:border-gray-300 dark:hover:bg-gray-800 dark:hover:border-gray-600'}
                                        `}
                                    >
                                        <div className={`p-2 rounded-lg shrink-0 ${['pdf'].includes(file.ext) ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400' :
                                            ['json', 'js'].includes(file.ext) ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400' :
                                                ['png', 'jpg'].includes(file.ext) ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' :
                                                    'bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400'
                                            }`}>
                                            <Icon name={getFileIcon(file.ext)} size={18} />
                                        </div>
                                        <div className="min-w-0 flex-1">
                                            <p className={`text-sm font-semibold truncate ${activeTabId === file.id ? 'text-indigo-700 dark:text-indigo-300' : 'text-gray-800 dark:text-gray-200'}`}>{file.name}</p>
                                            <p className="text-xs text-gray-500 dark:text-gray-400 truncate font-medium">{file.size}</p>
                                        </div>

                                        <button
                                            onClick={(e) => deleteFile(e, file.id)}
                                            className="absolute right-2 opacity-0 group-hover:opacity-100 p-1.5 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-all"
                                            title="Eliminar"
                                        >
                                            <Icon name="trash-2" size={14} />
                                        </button>

                                        {activeTabId === file.id && (
                                            <div className="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-indigo-500 rounded-l"></div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Drop Zone Mini */}
                        <div className="p-4 border-t border-gray-200/50 dark:border-gray-700/50">
                            <div
                                onClick={() => inputRef.current.click()}
                                className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-4 text-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition group bg-white/30 dark:bg-gray-800/30"
                            >
                                <Icon name="plus" size={24} className="mx-auto text-gray-500 group-hover:text-indigo-500 mb-1" />
                                <p className="text-xs font-bold text-gray-600 group-hover:text-indigo-600 dark:text-gray-300">Añadir archivos</p>
                                <input ref={inputRef} type="file" multiple className="hidden" onChange={(e) => processFiles(e.target.files)} />
                            </div>
                        </div>
                    </div>

                    {/* MAIN CONTENT */}
                    <div className="flex-1 flex flex-col min-w-0 bg-white/30 dark:bg-black/20 backdrop-blur-sm">

                        {/* Tab Bar */}
                        <div className="flex items-center gap-1 p-2 overflow-x-auto custom-scroll border-b border-gray-200/50 dark:border-gray-700/50">
                            {files.map(file => (
                                <div
                                    key={file.id}
                                    onClick={() => setActiveTabId(file.id)}
                                    className={`
                                        flex items-center gap-2 px-3 py-2 rounded-t-lg border-b-2 cursor-pointer min-w-[120px] max-w-[200px] transition-all group
                                        ${activeTabId === file.id
                                            ? 'bg-white dark:bg-gray-800 border-indigo-600 dark:border-indigo-400 text-indigo-700 dark:text-indigo-300 shadow-sm font-semibold'
                                            : 'border-transparent text-gray-600 dark:text-gray-400 hover:bg-white/60 dark:hover:bg-gray-800/60 font-medium'}
                                    `}
                                >
                                    <Icon name={getFileIcon(file.ext)} size={14} className="opacity-90" />
                                    <span className="text-xs font-bold truncate flex-1">{file.name}</span>
                                    <button
                                        onClick={(e) => deleteFile(e, file.id)}
                                        className="opacity-0 group-hover:opacity-100 hover:bg-red-200 hover:text-red-700 rounded p-0.5 transition"
                                    >
                                        <Icon name="x" size={12} />
                                    </button>
                                </div>
                            ))}
                        </div>

                        {/* Toolbar (Solo si hay archivo) */}
                        {activeFile && (
                            <div className="h-12 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 bg-white/90 dark:bg-gray-900/90">
                                <div className="flex items-center gap-4 text-sm font-medium text-gray-700 dark:text-gray-200">
                                    <span className="flex items-center gap-1"><Icon name="hard-drive" size={14} /> {activeFile.size}</span>
                                    <span className="w-px h-4 bg-gray-300 dark:bg-gray-600 py-1"></span>
                                    <span className="uppercase font-mono text-xs tracking-wider">{activeFile.ext}</span>
                                </div>

                                <div className="flex items-center gap-2">
                                    {/* Barra Busqueda interna (Solo para texto/json) */}
                                    {['text', 'json', 'markdown'].includes(activeFile.viewer) && (
                                        <div className="flex items-center gap-2 bg-white dark:bg-gray-800 px-3 py-1.5 rounded-full border border-gray-300 dark:border-gray-600 shadow-sm w-48 transition-all focus-within:w-64">
                                            <Icon name="search" size={14} className="text-gray-500 dark:text-gray-400" />
                                            <input
                                                type="text"
                                                placeholder="Buscar..."
                                                className="bg-transparent border-none outline-none text-xs w-full text-gray-900 dark:text-gray-100 placeholder-gray-500"
                                                value={contentSearch}
                                                onChange={(e) => setContentSearch(e.target.value)}
                                            />
                                        </div>
                                    )}

                                    <div className="h-4 w-px bg-gray-300 dark:bg-gray-600 mx-2"></div>

                                    <button
                                        onClick={(e) => deleteFile(e, activeFile.id)}
                                        className="p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
                                        title="Eliminar archivo"
                                    >
                                        <Icon name="trash-2" size={18} />
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Viewer Area */}
                        <div className="flex-1 p-6 overflow-hidden relative">
                            {activeFile ? (
                                <div className="w-full h-full animate-fade-in ring-1 ring-black/5 dark:ring-white/10 rounded-2xl shadow-sm bg-white dark:bg-gray-900 overflow-hidden">
                                    {(() => {
                                        switch (activeFile.viewer) {
                                            case 'json':
                                                return <JsonViewer data={activeFile.content} />;
                                            case 'markdown':
                                                return <MarkdownViewer content={activeFile.content} />;
                                            case 'image':
                                                return <ImageViewer fileUrl={activeFile.content} alt={activeFile.name} />;
                                            case 'pdf':
                                                return <iframe src={activeFile.content} className="w-full h-full" title="PDF" />;
                                            case 'text':
                                            default:
                                                return <TextViewer content={String(activeFile.content || '')} searchTerm={contentSearch} />;
                                        }
                                    })()}
                                </div>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-gray-400">
                                    <div className="w-20 h-20 bg-white/50 dark:bg-gray-800/50 rounded-full flex items-center justify-center mb-4 shadow-lg backdrop-blur-sm animate-bounce">
                                        <Icon name="command" size={40} className="text-indigo-400" />
                                    </div>
                                    <h3 className="text-xl font-semibold text-gray-600 dark:text-gray-300">Bienvenido a OmniFile v3</h3>
                                    <p className="max-w-xs text-center mt-2 opacity-70">Arrastra archivos aquí o usa el botón + para empezar.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
